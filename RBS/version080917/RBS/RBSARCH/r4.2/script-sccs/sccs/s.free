h55940
s 00002/00003/00053
d D 1.3 97/04/10 11:06:31 rous 3 2
c 
e
s 00056/00001/00000
d D 1.2 95/10/17 11:07:53 rous 2 1
c 
e
s 00001/00000/00000
d D 1.1 95/10/17 09:00:45 rous 1 0
c date and time created 95/10/17 09:00:45 by rous
e
u
U
f e 0
t
T
I 1
D 2
 
E 2
I 2
#! /bin/sh -e
#
case $# in
0) echo "Usage: free componentname filename"; exit 1;;
1) echo "Usage: free componentname filename"; exit 1;;
2) ;;
*) echo "Usage: free componentname filename"; exit 1;;
esac
savedir=`pwd`
cd $RBS_USER_ROOT$RBS_USER$RBS_RELEASE
#
#
#
trap '' 1 2 3
#
trap 'echo "FREE: No free allowed during your other frees"; umask 22; cd $savedir; exit 2' 0
umask 222
( echo "  " > $RBS_USER_ROOT$RBS_USER$RBS_RELEASE/free.rbs ) 2> /dev/null
umask 22
#
#
set -e
trap 'echo "FREE: No free allowed during your integrate"; rm -f $RBS_USER_ROOT$RBS_USER$RBS_RELEASE/free.rbs ; cd $savedir; exit 2' 0
if ( test -f $RBS_USER_ROOT$RBS_USER$RBS_RELEASE/integrate.rbs )
then exit 0
fi
#
#
set -e 
trap 'echo "FREE: Error during free" ; rm -f $RBS_USER_ROOT$RBS_USER$RBS_RELEASE/free.rbs ; cd $savedir ; exit 2' 0
##
#
#
if ( test "$1" = "actions" )
then cd actions
else cd $1/source
fi
if ( test -r $2 )
then if ( test -s $RBS_ARCHIVE$RBS_RELEASE/$1/sccs/s.$2 )
     then  chmod u+rwx $2
           sccs -d$RBS_ARCHIVE$RBS_RELEASE/$1 -psccs unedit $2 1> /dev/null 2>&1
D 3
           rm -f /tmp/$2
           mv $2 /tmp
           chmod 777 /tmp/$2
E 3
I 3
           mv $2 /tmp/$2.$$
           chmod 777 /tmp/$2.$$
E 3
     else echo "FREE: File does not exist in the archive!"
          exit
     fi 
else echo "FREE: File not in your source directory!"
     exit  
fi
#
#
#
rm -f $RBS_USER_ROOT$RBS_USER$RBS_RELEASE/free.rbs
cd $savedir
trap 0
E 2
E 1
